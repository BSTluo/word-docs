---
outline: [1,2]
---

# koishi-plugin-word-core-grammar-basic [词库引擎，基础语法扩展] 

***

# 基础说明

词库语法是指在回复和触发词中的特殊字符串，在触发词中，语法格式暂未固定，而在回复中：词库语法的规则是这样的
```
有参语法：
(语法名称:参数1:参数2:参数3:.......:参数n)

无参语法：
(语法名称)
```
具体参数个数取决于各个语法

## 添加物品到背包

### 语法格式：

|作用|语法格式|返回值|
|--|--|--|
|添加任意数量的物品到玩家背包|(+:`<物品名称>`:`<数量>`:`<用户id>?`)|操作的数量|
|添加随机数量的物品到玩家背包|(+:`<物品名称>`:`<数量~数量>`:`<用户id>?`)|操作的数量|
|添加以背包内原数量百分之x的物品到玩家背包|(+:`<物品名称>`:`<数量%>`:`<用户id?>`)|操作的数量|

当`用户id`为`that`时，代表为在触发时，被at的用户的id

`用户id`项可不填，此时此项前的`:`也不需要填写，这种情况下，为触发者自身添加物品

### 使用举例：

|作用|语法|返回值|
|--|--|--|
|添加1条小鱼干到背包|(+:小鱼干:1)|1|
|添加1~100随机条小鱼干到背包|(+:小鱼干:1~100)|18|
|添加30%*背包内小鱼干的数量到背包（如果背包内有100条鱼）|(+:小鱼干:30%)|30|
|添加1条小鱼干到被at的人的背包|(+:小鱼干:1:that)|1|

***

## 从背包内减少物品

### 语法格式：

|作用|语法格式|返回值|
|--|--|--|
|从玩家背包减少任意数量的物品|(-:`<物品名称>`:`<数量>`:`<用户id>?`)|操作的数量|
|从玩家背包减少随机数量的物品|(-:`<物品名称>`:`<数量~数量>`:`<用户id>?`)|操作的数量|
|从玩家背包减少以背包内原数量百分之x的物品|(-:`<物品名称>`:`<数量%>`:`<用户id>?`)|操作的数量|

当`用户id`为`that`时，代表为在触发时，被at的用户的id

`用户id`项可不填，此时此项前的`:`也不需要填写，这种情况下，为触发者自身减少物品

### 使用举例：

|作用|语法|返回值|
|--|--|--|
|减少1条小鱼干|(-:小鱼干:1)|1|
|减少1~100随机条小鱼干|(-:小鱼干:1~100)|18|
|减少30%背包内的小鱼干（如果背包内有100条鱼）|(-:小鱼干:30%)|30|
|被at的人减少1条小鱼干背包|(-:小鱼干:1:that)|1|

***

## 判断背包内物品数量是否满足要求

### 语法格式：

|作用|语法|
|--|--|
|当背包内物品的数量满足要求则显示`信息`，否则不显示|(?:`<物品名称>`:`<关系>`:`<数量>`:`<信息>?`:`<用户id>?`)|

`关系项`可以填写如下符号：

|大于|>|
|--|--|
|小于|<|
|等于|==|
|不等于|!=|
|大于等于|>=|
|小于等于|<=|

当`用户id`为 `that`时，代表为在触发时，被at的用户的id

`用户id`项可不填，此时此项前的`:`也不需要填写，这种情况下，为判断触发者自身的物品是否满足条件

`信息`项可不填或为空，当不填时此项前的`:`也不需要填写，这种情况下：

- 当物品数量满足要求时，继续执行本条语句
- 当物品数量不满足要求时，结束当前语句的执行重新从触发词的回答序列中随机挑选一句语句，重新解析直到无可执行的语句或语句成功输出时结束

### 使用举例：

|作用|语法|返回值|
|--|--|--|
|如果自身小鱼干>10，则显示你的小鱼干满足要求！|(?:小鱼干:>:10:你的鱼干满足要求啦！)|你的鱼干满足要求啦！|
|如果自身小鱼干>10，则继续执行本条解析|(?:小鱼干:>:10)|<语句继续运行>|
|如果对方的小鱼干>10，则提示你的也满足啦|(?:小鱼干:>:10:你的鱼干满足要求啦！:that)|你的鱼干满足要求啦！|
|如果对方的小鱼干>10，则继续执行本条语句|(?:小鱼干:>:10::that)|<语句继续运行>|


## 输出背包内某物品数量

### 语法格式：

|作用|语法|返回值|
|--|--|--|
|查看背包内小鱼干的数量|(#:`<物品名称>`:`<用户id>?`)|执行此语句时，背包内物品数量|

当`用户id`为 `that`时，代表为在触发时，被at的用户的id

`用户id`项可不填，此时此项前的:也不需要填写，这种情况下，为查询触发者自身物品数量

### 使用举例：

|作用|语法|返回值|
|--|--|--|
|查看自己的小鱼干数量|(#:小鱼干)|114|
|查看被at者的小鱼干数量|(#:小鱼干:that)|514|

***

## 概率判断是否成功

### 语法格式：

|作用|语法|返回值|
|--|--|--|
|有0~100的概率会输出`信息`项|(%:`<概率(0~100)>`:消息?)|`信息`项|

`信息`项可不填或为空，当不填时此项前的:也不需要填写，这种情况下：

- 当物品数量满足要求时，继续执行本条语句
- 当物品数量不满足要求时，终止执行

### 使用举例：

|作用|语法|返回值|
|--|--|--|
|30%的可能输出`赢啦`|(%:30:赢啦)|赢啦|

***

## 延迟发送

### 语法格式&使用举例：

|作用|语法|返回值|
|--|--|--|
|延迟发送一句话或者一段话|(&:`<时间>`:`<消息>?`)|`信息项`|

`时间`相为纯数字，单位是秒(s)

`信息`项可不填或为空，当不填时此项前的`:`也不需要填写，这种情况下：

- 延迟一定时间后发送此段回复词

### 使用举例：

|作用|语法|返回值|
|--|--|--|
|延迟10秒发送`哼哼a`|(&:10:哼哼a)|哼哼a|

***

## 查看触发者的用户名

### 语法格式&使用举例：

|作用|语法|返回值|
|--|--|--|
|查看触发者的名字|(@this)|触发者用户名|

***

## 查看触发者的id

### 语法格式&使用举例：

|作用|语法|返回值|
|--|--|--|
|查看触发者的id|(#this)|触发者id|

***

## 查看被at人的用户名

### 语法格式&使用举例：

|作用|语法|返回值|
|--|--|--|
|查看被at的对方的用户名|(@that)|在触发句中被at的人的用户名|

***

## 查看被at者的id

### 语法格式&使用举例：

|作用|语法|返回值|
|--|--|--|
|查看被at的对方的id|(#that)|在触发句中被at的人的id|

## at一个人

### 语法格式&使用举例：

|作用|语法|返回值|
|--|--|--|
|at一个昵称|(@:`<对方昵称>`)|at一个人|
|at一个唯一标识|(#:`<对方id>`)|at一个人|

## CD语法

### 语法格式：

|作用|语法|返回值|
|--|--|--|
|提示某段文本后，开始cd一定的秒数|(cd:`<事件名称>`:`<cd时间(格式为s)>`:`<信息>?`)|`信息项`|

`信息`项可不填或为空，当不填时此项前的:也不需要填写，这种情况下：

- 当第一次触发时，继续运行，创建一个名为`事件名称`的计时器
- 在计时器未记完时，结束当前语句的执行重新从触发词的回答序列中随机挑选一句语句，重新解析直到无可执行的语句或语句成功输出时结束
- 计时器记完后触发，视为第一条

### 使用举例：

|作用|语法|返回值|
|--|--|--|
|发送你好后，10秒后触发才可以继续发送你好|(cd:你好cd:10:你好)|你好|

## 获取触发时所输入的数

### 语法格式：

|作用|语法|返回值|
|--|--|--|
|获取触发句中`(数)`所代表的数字|(数:`<第几个输入的数>`)|触发句中`(数)`所代表的数字|

### 使用举例：

|作用|语法|返回值|
|--|--|--|
|获取用户输入的第一个数|(数:1)|第一个数|

设定一个这样的问答：

问：你好(数)
答：(数:1)

此时，你发送：`你好12345`，机器人会回复：`12345`

## 四则运算

### 语法格式：

|作用|语法|返回值|
|--|--|--|
|进行四则运算|(算:`<第一个数>`:`<算术符号>`:`<第二个数>`)|`第一个数`和`第二个数`进行四则运算|

`算数符号`有如下四种：`+`，`-`，`*`，`/`

### 使用举例：

|作用|语法|返回值|
|--|--|--|
|运算3+1|(算:3:+:1)|4|

## 生成随机数

### 语法格式：

|作用|语法|返回值|
|--|--|--|
|生成一个随机数|(~:`<下限>`:`<上限>`)|生成一个在`下限`和`上限`之间的一个随机数|

### 使用举例：

|作用|语法|返回值|
|--|--|--|
|生成一个0~100的随机数|(~:0:100)|35|

## 获取时间

### 语法格式：

|作用|语法|返回值|
|--|--|--|
|获取年/月/星期/日/时/分/秒|(time:`<模式选择>`)|年/月/星期/日/时/分/秒|

`格式选择项`有如下值：

- 获取年：1
- 获取月：2
- 获取星期：3
- 获取日：4
- 获取时：5
- 获取分：6
- 获取秒：7

### 使用举例：

|作用|语法|返回值|
|--|--|--|
|获取现在是一周的星期几|(time:3)|2|

## 数字取整

### 语法格式&&使用举例：

|作用|语法|返回值|
|--|--|--|
|数值取整(向下取整)|(整:`<数值>`)|`数值`项的向下取整|
|取2.2这个数字为2|(整:2.2)|2|

## 分段回复

### 语法格式&&使用举例

|作用|语法|返回值|
|--|--|--|
|分为两个气泡发送|(换)|`多个气泡`|
|将aaa与bbb分为两段话|aaa(换)bbb|第一个气泡：aaa，第二个气泡：bbb|

## 弹出提示，获取输入

### 语法格式&&使用举例

|作用|语法|返回值|
|--|--|--|
|弹出气泡，等待用户输入|(wi:`<输入的值的备注>?`)|`输入提示`|
|需要输入数量|你输入了：(wi:`<数量>`)|请输入`数量`参数的值：|
|获取一个输入|你输入了：(wi)|请输入：|

备注：
`(wi:输入的值的备注)`中`:输入的值的备注`可不写，此时，弹出的提示消息会不包含 `xxx参数的值`字样。

当输入超时时（5秒内未输入），输入的数值则为空

(ps:在想要不要加个参数项，可以进行正则校验输入的文字格式)

##  物品排行榜

### 语法格式&&使用举例

|作用|语法|返回值|
|--|--|--|
|获取某物品的数量排行榜|(排行榜:`<物品名称>`)|某物品的排行榜|

##  权限验证

### 语法格式&&使用举例

|作用|语法|返回值|
|--|--|--|
|判断触发者是否拥有某权限|(p:`<权限名>`:`<消息>?`)|`消息`项|

`信息`项可不填或为空，当不填时此项前的`:`也不需要填写，这种情况下：

- 当权限满足要求时，继续执行本条语句
- 当权限不满足要求时，结束当前语句的执行重新从触发词的回答序列中随机挑选一句语句，重新解析直到无可执行的语句或语句成功输出时结束

## 音频点播

### 语法格式&&使用举例

|作用|语法|返回值|
|--|--|--|
|发送一段音频|(歌曲:`<歌曲url直链>`)|一段音乐~|

## 视频点播

### 语法格式&&使用举例

|作用|语法|返回值|
|--|--|--|
|发送一段视频|(视频:`<视频url直链>`)|一段音乐~|

## 禁言

### 语法格式&&使用举例

|作用|语法|返回值|
|--|--|--|
|禁言触发者|(禁言:`<时间>`)|禁言触发者|
|禁言指定人员|(禁言:`<时间>`:`<用户id>`)|禁言指定的人|
|禁言时附带理由|(禁言:`<时间>`:`<用户id>`:`<理由>`)|禁言指定的人并且附带理由|

备注： 时间单位是s，为0时则解禁

## 踢

### 语法格式&&使用举例

|作用|语法|返回值|
|--|--|--|
|踢掉触发者|(踢)|触发者被踢了|
|踢掉指定的人|(踢:`<用户id>`:0)|指定的人被踢了|
|永久踢出|(踢:`<用户id>`:1)|指定的人被永久踢出了|

## 隐藏输出

### 语法格式&&使用举例

|作用|语法|返回值|
|--|--|--|
|隐藏xxx|(!:xxx)|`无`|

## 调用触发词

### 语法格式

|作用|语法|返回值|
|--|--|--|
|同步调用触发词|(调:`<触发词>`)|触发词的一个回复|
|异步调用触发词|(异调:`<触发词>`)|触发词的一个回复|

使词库触发一个触发词，并且将此触发词的随机一个结果返回

#### 使用举例以及注意事项

此时原回复依旧正在解析，而词库在每次解析完成后才会将此回复产生的添加物品之类的数据写入背包中，所以在调用新的语句
的时候，背包内容是调用所在语句未开始的时候的状态！
举个例子：

玩家初始时，拥有3条鱼。

```
word.add 钓鱼 你获得了(+:鱼:1)条鱼,(调:test)
word.add test 你有(#:鱼)条鱼
```

触发钓鱼时，你会获得一条鱼，但是此时它并未写入到背包中，而是存储在缓存中。调用test触发词的结果是：你有3条鱼，但在调用后，钓鱼触发词的此回复被成功解析，缓存的数据被写入到背包，此时你已经有4条鱼了，但是整句话是`你获得了1条鱼,你有3条鱼`

而同步调用和异步调用的区别是，同步调用被执行后会等待调用结果的返回，而异步调用被执行后不等待，结果会通过新的气泡来发送出来

## 发送http(s)的post/get请求

### 语法格式

|作用|语法|返回值|
|--|--|--|
|发送http post请求|(post:`<接口链接>`:`<headersJson>`:`<bodyJson>`:`<需要的返回值>`)|请求一个post接口，并且获取它的返回|
|发送https post请求|(posts:`<接口链接>`:`<headersJson>`:`<bodyJson>`:`<需要的返回值>`)|请求一个post接口，并且获取它的返回|
|发送http get请求|(get:`<接口链接>`:`<headersJson>`:`<bodyJson>`:`<需要的返回值>`)|请求一个get接口，并且获取它的返回|
|发送https get请求|(gets:`<接口链接>`:`<headersJson>`:`<bodyJson>`:`<需要的返回值>`)|请求一个get接口，并且获取它的返回|

使词库请求一个http接口，并且获取它的返回值

### 语法参数详解

以请求这个获取天气情况的接口为例：

[感谢韩小韩接口！](https://api.vvhan.com/article/tianqi.html)

|参数|格式说明|示例|
|--|--|--|
|接口链接|http接口的地址|https://api.vvhan.com/api/weather|
|headersJson|接口要求的头数据，是类似http的get请求的格式：`键1=值1&键2=值2`|Authorization=hdbjsdkadv&Content-Type=application/json(韩小韩dalao的接口木这个参数哈)|
|bodyJson|接口要求的body数据，格式也是`键1=值1&键2=值2`|city=北京|
|需要的返回值|接口返回的数据，可以是`纯文本`或者为`返回值中的项(需要写成类似这样的格式：data.xxx)`，同时，可以获取多个返回的值，最终语法的返回值会将所有结果拼接起来|`data.data.high`   `最高气温`|

需要注意，在请求的内容中包含`:`时，需要输入在前方输入一个\，变成`\:`来防止被词库处理为参数分隔符。

以上述描述，使用韩小韩接口获取北京的天气情况的语法是这样的：

```javascript
第一种写法：
(gets:api.vvhan.com/api/weather::city=北京:\n最高温度:data.data.high:\n最低温度:data.data.low:\n小贴士提醒你！:data.tip)"

第二种写法
(gets:api.vvhan.com/api/weather::city=北京:
最高温度:data.data.high:
最低温度:data.data.low:
小贴士提醒你\::data.tip)"

// ps：这两种写法其实是一样的，因为\n是指回车一次
```

它最终的返回值是：

```

最高温度24°C
最低温度16°C
小贴士提醒你:现在的温度比较舒适~
```

## 多重概率判定

### 语法格式

|作用|语法|返回值|
|--|--|--|
|多重概率判断|(%%:`<概率权重1>`:`<成功后的文本1>`:`<概率权重2>`:`<成功后的文本2>`:`<概率权重3>`:`<成功后的文本3>`:.........:`<概率权重n>`:`<成功后的文本n>`)|`<成功后的文本>`项目|

### 使用举例

比如，有如下语法

`word.add test (%%:1:a:2:aa:3:aaa)`

上述这样的情况下我们发送`test`后，bot返回`a`的几率是`1/(1+2+3)`，`aa`的概率是`2/(1+2+3)`，`aaa`的概率是`3/(1+2+3)`...以此类推